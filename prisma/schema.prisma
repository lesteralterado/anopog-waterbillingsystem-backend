generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model roles {
  id   BigInt  @id @default(autoincrement())
  name String  @unique
  user users[]
}

model users {
  id             BigInt           @id @default(autoincrement())
  username       String           @unique
  password       String
  role_id        BigInt
  issues         issues[]
  meter_readings meter_readings[]
  notifications  notifications[]
  role           roles            @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  // Keep a relation to the `puroks` table (many-to-many) and also store a simple
  // scalar `purok` value for compatibility with the frontend payload.
  puroks         puroks[]         @relation("puroksTousers")
  purok          String?
  device_token   String?

  // Additional profile fields requested by the frontend
  meter_number   String?
  full_name      String?
  address        String?
  phone          String?
  email          String?
}

model puroks {
  id    BigInt  @id @default(autoincrement())
  name  String  @unique
  users users[] @relation("puroksTousers")
}

model meter_readings {
  id            BigInt   @id @default(autoincrement())
  user_id       BigInt
  reading_date  DateTime @db.Date
  reading_value Decimal  @db.Decimal
  image_url     String?
  user          users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model bills {
  id               Int      @id @default(autoincrement())
  user_id          Int
  meter_reading_id Int
  amount_due       Float
  due_date         DateTime
  is_paid          Boolean
  payments         payments[]
}

model payments {
  id             BigInt   @id @default(autoincrement())
  bill_id        Int
  payment_date   DateTime @db.Date
  payment_method String
  amount_paid    Decimal  @db.Decimal
  bill           bills    @relation(fields: [bill_id], references: [id])
}

model issues {
  id            BigInt    @id @default(autoincrement())
  user_id       BigInt
  description   String
  reported_date DateTime  @db.Date
  is_resolved   Boolean?  @default(false)
  resolved_date DateTime? @db.Date
  fixing_date   DateTime? @db.Date
  user          users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model notifications {
  id                BigInt   @id @default(autoincrement())
  user_id           BigInt
  message           String
  notification_date DateTime @db.Date
  user              users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
